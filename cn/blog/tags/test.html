<!doctype html>
<html lang="zh-CN" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">2 篇 被标记 &quot;Test&quot; | HwameiStor</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://hwameistor.io/cn/blog/tags/test"><meta data-rh="true" name="docusaurus_locale" content="cn"><meta data-rh="true" name="docsearch:language" content="cn"><meta data-rh="true" property="og:title" content="2 篇 被标记 &quot;Test&quot; | HwameiStor"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/cn/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://hwameistor.io/cn/blog/tags/test"><link data-rh="true" rel="alternate" href="https://hwameistor.io/blog/tags/test" hreflang="en-GB"><link data-rh="true" rel="alternate" href="https://hwameistor.io/cn/blog/tags/test" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://hwameistor.io/blog/tags/test" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/cn/blog/rss.xml" title="HwameiStor RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/cn/blog/atom.xml" title="HwameiStor Atom Feed"><link rel="stylesheet" href="/cn/assets/css/styles.b1b5b1e9.css">
<link rel="preload" href="/cn/assets/js/runtime~main.4ec86df7.js" as="script">
<link rel="preload" href="/cn/assets/js/main.20355232.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到正文"><a href="#" class="skipToContent_fXgn">跳到正文</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/cn/"><div class="navbar__logo"><img src="/cn/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/cn/img/logo_dark.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">HwameiStor</b></a><a class="navbar__item navbar__link" href="/cn/docs/intro">文档</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cn/blog">博客</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>中文</a><ul class="dropdown__menu"><li><a href="/blog/tags/test" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en-GB">English</a></li><li><a href="/cn/blog/tags/test" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-CN">中文</a></li></ul></div><a href="https://github.com/hwameistor/hwameistor" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换淡色/暗色模式 (当前 淡色模式)" aria-label="切换淡色/暗色模式 (当前 淡色模式)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="浏览最新的博文"><div class="sidebarItemTitle_pO2u margin-bottom--md">最新的博文</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/cn/blog/minio">HwameiStor 对 Minio 的支持</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/cn/blog/live">直播回顾论道原生：云原生存储</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/cn/blog/test">HwameiStor 能力、安全及运维测试</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/cn/blog/3">LV 和 LVReplica</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/cn/blog/2">HwameiStor Reliable Helper System 开源上线</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>2 篇 被标记 &quot;Test&quot;</h1><a href="/cn/blog/tags">查看所有的标签</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/cn/blog/minio">HwameiStor 对 Minio 的支持</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-07-16T00:00:00.000Z" itemprop="datePublished">July 16, 2022</time> · <!-- -->11 分钟阅读</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/zhaosimon" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/36882380?v=4" alt="赵燕宁"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/zhaosimon" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">赵燕宁</span></a></div><small class="avatar__subtitle" itemprop="description">开发者</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>本文讲述如何以 HwameiStor 为底座，搭建 MinIO 存储解决方案，实践验证了 MinIO 的各项基本功能和多租户隔离测试。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="minio-简介">MinIO 简介<a class="hash-link" href="#minio-简介" title="直接链接到标题">​</a></h2><p>MinIO 是一款高性能、分布式、兼容 S3 的多云对象存储系统套件。MinIO 原生支持 Kubernetes，能够支持所有公有云、私有云及边缘计算环境。
MinIO 是 GNU AGPL v3 开源的软件定义产品，能够很好地运行在标准硬件如 X86 等设备上。</p><p><img loading="lazy" alt="MinIO 架构" src="/cn/assets/images/minio-design-50c5ded4364db203250dc5f007b8f613.png" width="245" height="219" class="img_ev3q"></p><p>MinIO 的架构设计从一开始就是针对性能要求很高的私有云标准，在实现对象存储所需要的全部功能的基础上追求极致的性能。
MinIO 具备易用性、高效性及高性能，能够以更简单的方式提供具有弹性伸缩能力的云原生对象存储服务。</p><p>MinIO 在传统对象存储场景（如辅助存储、灾难恢复和归档）方面表现出色，同时在机器学习、大数据、私有云、混合云等方面的存储技术上也独树一帜，包括数据分析、高性能应用负载、原生云应用等。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="minio-架构设计">MinIO 架构设计<a class="hash-link" href="#minio-架构设计" title="直接链接到标题">​</a></h3><p>MinIO 为云原生架构设计，可以作为轻量级容器运行并由外部编排服务如 Kubernetes 管理。
MinIO 整个服务包约为不到 100 MB 的静态二进制文件，即使在很高负载下也可以高效利用 CPU 和内存资源并可以在共享硬件上共同托管大量租户。
对应的架构图如下：</p><p><img loading="lazy" alt="架构图" src="/cn/assets/images/architect-ce129da6d73d13ffdbb0e813bb33fe58.png" width="1092" height="684" class="img_ev3q"></p><p>MinIO 用作云原生应用程序的主要存储，与传统对象存储相比，云原生应用程序需要更高的吞吐量和更低的延迟，而这些都是 MinIO 能够达成的性能指标，读/写速度高达 183 GB/秒和 171 GB/秒。</p><p>MinIO 极致的高性能离不开底层存储基础平台。本地存储在众多的存储协议中具有最高的读写性能无疑能为 MinIO 提供性能保障。
HwameiStor 正是满足云原生时代要求的储存系统。它具有高性能、高可用、自动化、低成本、快速部署等优点，可以替代昂贵的传统 SAN 存储。</p><p>MinIO 可以在带有本地驱动器（JBOD/JBOF）的标准服务器上运行。
集群为完全对称的体系架构，即所有服务器的功能均相同，没有名称节点或元数据服务器。</p><p>MinIO 将数据和元数据作为对象一起写入从而无需使用元数据数据库。
MinIO 以内联、严格一致的操作执行所有功能，包括擦除代码、位 rotrot 检查、加密等。</p><p>每个 MinIO 集群都是分布式 MinIO 服务器的集合，每个节点一个进程。
MinIO 作为单个进程在用户空间中运行，并使用轻量级的协同例程来实现高并发。
将驱动器分组到擦除集（默认情况下，每组 16 个驱动器），然后使用确定性哈希算法将对象放置在这些擦除集上。</p><p>MinIO 专为大规模、多数据中心云存储服务而设计。
每个租户都运行自己的 MinIO 集群，该集群与其他租户完全隔离，从而使租户能够免受升级、更新和安全事件的任何干扰。
每个租户通过联合跨地理区域的集群来独立扩展。</p><p><img loading="lazy" alt="node-distribution-setup" src="/cn/assets/images/node-setup-83bd490fd5bac9fadf3650ed4d61314e.png" width="1271" height="1057" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="以-hwameistor-为底座搭建-minio-的优势">以 HwameiStor 为底座搭建 MinIO 的优势<a class="hash-link" href="#以-hwameistor-为底座搭建-minio-的优势" title="直接链接到标题">​</a></h3><p>以 HwameiStor 为底座搭建 MinIO 存储方案，构建智、稳、敏全面增强本地存储，具备以下优势。</p><ul><li><p>自动化运维管理</p><p>可以自动发现、识别、管理、分配磁盘。 根据亲和性，智能调度应用和数据。自动监测磁盘状态，并及时预警。</p></li><li><p>高可用的数据</p><p>使用跨节点副本同步数据， 实现高可用。发生问题时，会自动将应用调度到高可用数据节点上，保证应用的连续性。</p></li><li><p>丰富的数据卷类型</p><p>聚合 HDD、SSD、NVMe 类型的磁盘，提供非低延时，高吞吐的数据服务。</p></li><li><p>灵活动态的线性扩展</p><p>可以根据集群规模大小进行动态的扩容，灵活满足应用的数据持久化需求。</p></li><li><p>丰富的应用场景，广泛适配企业需求，适配高可用架构中间件</p><p>类似 Kafka、ElasticSearch、Redis 等这类中间件自身具备高可用架构，同时对数据的 IO 访问有很高要求。
HwameiStor 提供的基于 LVM 的单副本本地数据卷，可以很好地满足它们的要求。</p></li><li><p>为应用提供高可用数据卷</p><p>MySQL 等 OLTP 数据库要求底层存储提供高可用的数据存储，当发生问题时可快速恢复数据，同时也要求保证高性能的数据访问。
HwameiStor 提供的双副本的高可用数据卷，可以很好地满足此类需求。</p></li><li><p>自动化运维传统存储软件</p><p>MinIO、Ceph 等存储软件，需要使用 Kubernetes 节点上的磁盘，可以采用 PVC/PV 的方式，
通过 CSI 驱动自动化地使用 HwameiStor 的单副本本地卷，快速响应业务系统提出的部署、扩容、迁移等需求，实现基于 Kubernetes 的自动化运维。</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="测试环境">测试环境<a class="hash-link" href="#测试环境" title="直接链接到标题">​</a></h2><p>按照以下步骤依次部署 Kubernetes 集群、HwameiStor 本地存储和 MinIO。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="部署-kubernetes-集群">部署 Kubernetes 集群<a class="hash-link" href="#部署-kubernetes-集群" title="直接链接到标题">​</a></h3><p>本次测试使用了三台虚拟机节点部署了 Kubernetes 集群：1 Master + 2 Worker 节点，kubelet 版本为 1.22.0。</p><p><img loading="lazy" alt="k8s-cluster" src="/cn/assets/images/k8s-cluster-2e9998ffef1d3a00bad3b7e3a164e4ff.png" width="553" height="117" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="部署-hwameistor-本地存储">部署 HwameiStor 本地存储<a class="hash-link" href="#部署-hwameistor-本地存储" title="直接链接到标题">​</a></h3><p>在 Kubernetes 上部署 HwameiStor 本地存储。</p><p><img loading="lazy" alt="查看 HwameiStor 本地存储" src="/cn/assets/images/kubectl-get-hwamei-pod-0cd9b8d67e92c776b7bcd8b348f70496.png" width="553" height="87" class="img_ev3q"></p><p>两台 Worker 节点各配置了五块磁盘（SDB、SDC、SDD、SDE、SDF）用于 HwameiStor 本地磁盘管理。</p><p><img loading="lazy" alt="lsblk" src="/cn/assets/images/lsblk01-1b81d8560261b1885437ed9fb82481cc.png" width="553" height="192" class="img_ev3q"></p><p><img loading="lazy" alt="lsblk" src="/cn/assets/images/lsblk02-9d75cd284b90f360762e7b6b4003f1fe.png" width="553" height="147" class="img_ev3q"></p><p>查看 local storage node 状态。</p><p><img loading="lazy" alt="get-lsn" src="/cn/assets/images/kubectl-get-lsn-9655d5b584e42874a92047354ff54c15.png" width="553" height="67" class="img_ev3q"></p><p>创建了 storagClass。</p><p><img loading="lazy" alt="get-sc" src="/cn/assets/images/kubectl-get-sc-860a03c344d7d8b2e26157ca5f6730a9.png" width="553" height="48" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="分布式多租户源码部署安装minio-operator">分布式多租户源码部署安装（minio operator）<a class="hash-link" href="#分布式多租户源码部署安装minio-operator" title="直接链接到标题">​</a></h2><p>本节说明如何部署 minio operator，如何创建租户，如何配置 HwameiStor 本地卷。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="部署-minio-operator">部署 minio operator<a class="hash-link" href="#部署-minio-operator" title="直接链接到标题">​</a></h3><p>参照以下步骤部署 minio operator。</p><ol><li><p>复制 minio operator 仓库到本地。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">git clone &lt;https://github.com/minio/operator.git&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制到剪切板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="helm-repo-list" src="/cn/assets/images/helm-repo-list-f96e598528d3d564bcbb129221360620.png" width="538" height="50" class="img_ev3q"></p><p><img loading="lazy" alt="ls-operator" src="/cn/assets/images/ls-opeartor-2d0c847e0ae10e022f408516d0b15c46.png" width="554" height="47" class="img_ev3q"></p></li><li><p>进入 helm operator 目录：<code>/root/operator/helm/operator</code>。</p><p><img loading="lazy" alt="ls-pwd" src="/cn/assets/images/ls-pwd-177620b3543a6e3211f2ada8d9af1893.png" width="448" height="119" class="img_ev3q"></p></li><li><p>部署 minio-operator 实例。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm install minio-operator \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--namespace minio-operator \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--create-namespace \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--generate-name .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--set persistence.storageClass=local-storage-hdd-lvm .</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制到剪切板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>检查 minio-operator 资源运行情况。</p><p><img loading="lazy" alt="get-all" src="/cn/assets/images/kubectl-get-all-026455ec24122121ef5763df0c6f1d71.png" width="553" height="252" class="img_ev3q"></p></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="创建租户">创建租户<a class="hash-link" href="#创建租户" title="直接链接到标题">​</a></h3><p>参照以下步骤创建一个租户。</p><ol><li><p>进入 <code>/root/operator/examples/kustomization/base</code> 目录。如下修改 tenant.yaml。</p><p><img loading="lazy" alt="git-diff-yaml" src="/cn/assets/images/git-diff-tenant-yaml-7ae47ae03222e56b47635aea676dc294.png" width="553" height="489" class="img_ev3q"></p></li><li><p>进入 <code>/root/operator/helm/tenant/</code> 目录。如下修改 <code>values.yaml</code> 文件。</p><p><img loading="lazy" alt="git-diff-values.yaml" src="/cn/assets/images/git-diff-values-yaml-4a948a45aba4b18a76b4938e24b0dfe7.png" width="553" height="576" class="img_ev3q"></p></li><li><p>进入 <code>/root/operator/examples/kustomization/tenant-lite</code> 目录。如下修改 <code>kustomization.yaml</code> 文件。</p><p><img loading="lazy" alt="git-diff-kustomization-yaml" src="/cn/assets/images/git-diff-kustomization-yaml-0ad007bd15ea443b07d8366fb2eb65bd.png" width="553" height="249" class="img_ev3q"></p></li><li><p>如下修改 <code>tenant.yaml</code> 文件。</p><p><img loading="lazy" alt="git-diff-tenant-yaml02" src="/cn/assets/images/git-diff-tenant-yaml02-24937bd8e84cfb6f82a3d4c61f3cb5ff.png" width="553" height="266" class="img_ev3q"></p></li><li><p>如下修改 <code>tenantNamePatch.yaml</code> 文件。</p><p><img loading="lazy" alt="git-diff-tenant-name-patch-yaml" src="/cn/assets/images/git-diff-tenant-name-patch-yaml-4b8be598ff292c9492f86640650d8a0c.png" width="553" height="125" class="img_ev3q"></p></li><li><p>创建租户：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply –k . </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制到剪切板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>检查租户 minio-t1 资源状态：</p><p><img loading="lazy" alt="kubectl-get-all-nminio-tenant" src="/cn/assets/images/kubectl-get-all-nminio-tenant-497b2e2eab8bb4d29b3de1c0b1a6dd7b.png" width="553" height="322" class="img_ev3q"></p></li><li><p>如要创建一个新的租户可以在 <code>/root/operator/examples/kustomization</code> 目录下建一个新的 <code>tenant</code> 目录（本案例为 <code>tenant-lite-2</code>）并对相应文件做对应修改。</p><p><img loading="lazy" alt="pwd-ls-ls" src="/cn/assets/images/pwd-ls-ls-3c18ba9e4e0eabed279cac4788adc00e.png" width="1078" height="209" class="img_ev3q"></p></li><li><p>执行 <code>kubectl apply –k .</code> 创建新的租户 <code>minio-t2</code>。</p><p><img loading="lazy" alt="kubectl-get-all-nminio" src="/cn/assets/images/kubectl-get-all-minio-8c0df6d0f7c86bf1ac6260795a55ab3c.png" width="1022" height="659" class="img_ev3q"></p></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置-hwameistor-本地卷">配置 HwameiStor 本地卷<a class="hash-link" href="#配置-hwameistor-本地卷" title="直接链接到标题">​</a></h3><p>依次运行以下命令来配置本地卷。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get statefulset.apps/minio-t1-pool-0 -nminio-tenant -oyaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制到剪切板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="local-storage-hdd-lvm" src="/cn/assets/images/local-storage-hdd-lvm-214813a44eb9b94a4a7c12b592bdca77.png" width="437" height="382" class="img_ev3q"></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pvc –A</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制到剪切板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="kubectl-get-pvc" src="/cn/assets/images/kubectl-get-pvc-b00f37660c7a43e7a79d9fdb12116a6b.png" width="553" height="105" class="img_ev3q"></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pvc export-minio6-0 -nminio-6 -oyaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制到剪切板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="kubectl-get-pvc-export-oyaml" src="/cn/assets/images/kubectl-get-pvc-export-oyaml-bd9d6c3aea26b5e4217bb163f26b68f9.png" width="553" height="371" class="img_ev3q"></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pv</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制到剪切板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="kubectl-get-pv" src="/cn/assets/images/kubectl-get-pv-d6a7f8f8d6abe20eb23588513908066d.png" width="553" height="85" class="img_ev3q"></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pvc data0-minio-t1-pool-0-0 -nminio-tenant -oyaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制到剪切板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="kubectl-get-pvc-oyaml" src="/cn/assets/images/kubectl-get-pvc-oyaml-71f7f2ebc33ee977d2c399425bab30bd.png" width="553" height="448" class="img_ev3q"></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get lv</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制到剪切板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="kubectl-get-lv" src="/cn/assets/images/kubectl-get-lv-b1a03ec396f97f755f15ad387225c38a.png" width="553" height="95" class="img_ev3q"></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubect get lvr</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制到剪切板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="kubectl-get-lvr" src="/cn/assets/images/kubectl-get-lvr-aa5334390dd09d70b369178e2a40df54.png" width="553" height="86" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="hwameistor-与-minio-测试验证">HwameiStor 与 MinIo 测试验证<a class="hash-link" href="#hwameistor-与-minio-测试验证" title="直接链接到标题">​</a></h2><p>完成上述配置之后，执行了基本功能测试和多租户隔离测试。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="基本功能测试">基本功能测试<a class="hash-link" href="#基本功能测试" title="直接链接到标题">​</a></h3><p>基本功能测试的步骤如下。</p><ol><li><p>从浏览器登录 <code>minio console：10.6.163.52:30401/login</code>。</p><p><img loading="lazy" alt="minio-opeartor-console-login" src="/cn/assets/images/minio-opeartor-console-login-d2690ef3832515f90e4bb546c515cc0f.png" width="681" height="369" class="img_ev3q"></p></li><li><p>通过 <code>kubectl minio proxy -n minio-operator </code>获取 JWT。</p><p><img loading="lazy" alt="minio-opeartor-console-login" src="/cn/assets/images/kubectl-minio-proxy-jwt-9e10468de2cb3110cccb7949ba403e65.png" width="1144" height="328" class="img_ev3q"></p></li><li><p>浏览及管理创建的租户信息。</p><p><img loading="lazy" alt="tenant01" src="/cn/assets/images/tenant01-823ef226f559957037ea57ed833ef2c2.png" width="1265" height="562" class="img_ev3q"></p><p><img loading="lazy" alt="tenant02" src="/cn/assets/images/tenant02-847ee3e98f7fb5cad5151f28d1624676.png" width="1265" height="715" class="img_ev3q"></p><p><img loading="lazy" alt="tenant03" src="/cn/assets/images/tenant03-39a6e5a9ece83b93a6fc68bdf709db12.png" width="1265" height="583" class="img_ev3q"></p><p><img loading="lazy" alt="tenant04" src="/cn/assets/images/tenant04-517db946c00cc899af5dc790a055f793.png" width="1265" height="748" class="img_ev3q"></p><p><img loading="lazy" alt="tenant05" src="/cn/assets/images/tenant05-3a12444cc96c9cd2dbf73fa722b9b2c0.png" width="1271" height="733" class="img_ev3q"></p><p><img loading="lazy" alt="tenant06" src="/cn/assets/images/tenant06-15e19517c953f7c9820da7c818837250.png" width="1271" height="855" class="img_ev3q"></p></li><li><p>登录 minio-t1 租户（用户名 minio，密码 minio123）。</p><p><img loading="lazy" alt="login-minio" src="/cn/assets/images/login-minio-t1-01-68939a43710d29e15a94152ff248f7a6.png" width="1265" height="760" class="img_ev3q"></p><p><img loading="lazy" alt="login-minio" src="/cn/assets/images/login-minio-t1-02-b65ab20229aa0efd8e586c7467514ab6.png" width="1265" height="754" class="img_ev3q"></p></li><li><p>浏览 bucket bk-1。</p><p><img loading="lazy" alt="view-bucket-1" src="/cn/assets/images/view-bucket-01-50f2dac3e66f455de29df8ea6679f7fc.png" width="1271" height="409" class="img_ev3q"></p><p><img loading="lazy" alt="view-bucket-1" src="/cn/assets/images/view-bucket-02-fb93474795cf22f2edea0fde91a5ad19.png" width="1271" height="378" class="img_ev3q"></p><p><img loading="lazy" alt="view-bucket-1" src="/cn/assets/images/view-bucket-03-313ac3d13919cc855ac4e5e17d9cf61f.png" width="1271" height="467" class="img_ev3q"></p></li><li><p>创建新的 bucket bk-1-1。</p><p><img loading="lazy" alt="create-bucket-1-1" src="/cn/assets/images/create-bucket-1-1-6dd53d944ee882f572e7f1d4599ca021.png" width="1271" height="415" class="img_ev3q"></p><p><img loading="lazy" alt="create-bucket-1-1" src="/cn/assets/images/create-bucket-1-2-16fe74cc6ae2eac86d13da593666f786.png" width="1271" height="669" class="img_ev3q"></p><p><img loading="lazy" alt="create-bucket-1-1" src="/cn/assets/images/create-bucket-1-3-8388f7f0c3ae95ef6086aebd48e9bc8a.png" width="1271" height="354" class="img_ev3q"></p></li><li><p>创建 path path-1-2。</p><p><img loading="lazy" alt="create-path-1-2" src="/cn/assets/images/create-path-1-2-01-a92a560272a856ed5844706f34e201a2.png" width="1265" height="644" class="img_ev3q"></p><p><img loading="lazy" alt="create-path-1-2" src="/cn/assets/images/create-path-1-2-02-dbc0eb8def9147bbbab83a8ded628579.png" width="1271" height="336" class="img_ev3q"></p></li><li><p>上传文件成功：</p><p><img loading="lazy" alt="upload-file" src="/cn/assets/images/upload-file-success-71d39754b906216229e242c7a9691b88.png" width="1271" height="375" class="img_ev3q"></p><p><img loading="lazy" alt="upload-file" src="/cn/assets/images/upload-file-success-02-f26a3be0810b08e933b1a53e894840e7.png" width="1265" height="534" class="img_ev3q"></p><p><img loading="lazy" alt="upload-file" src="/cn/assets/images/upload-file-success-03-94d9c32d8be5cb1fcf7e791f6e0564e6.png" width="1271" height="495" class="img_ev3q"></p></li><li><p>上传文件夹成功：</p><p><img loading="lazy" alt="upload-folder" src="/cn/assets/images/upload-folder-success-01-ce4cca3d1572ed78c4d1445ef8ec5092.png" width="1271" height="406" class="img_ev3q"></p><p><img loading="lazy" alt="upload-folder" src="/cn/assets/images/upload-folder-success-02-8f527aa3a8d07d88c957615746852652.png" width="1271" height="375" class="img_ev3q"></p><p><img loading="lazy" alt="upload-folder" src="/cn/assets/images/upload-folder-success-03-d4251b86ee85bd5792e199680e9bb763.png" width="1265" height="495" class="img_ev3q"></p><p><img loading="lazy" alt="upload-folder" src="/cn/assets/images/upload-folder-success-04-ba90cf6c9b40c242cdb6e7bbd4e77ff1.png" width="1265" height="501" class="img_ev3q"></p></li><li><p>创建只读用户：</p><p><img loading="lazy" alt="create-user" src="/cn/assets/images/create-readonly-user-01-c0dfec1a26c75309bd158812dfa38440.png" width="1271" height="745" class="img_ev3q"></p><p><img loading="lazy" alt="create-user" src="/cn/assets/images/create-readonly-user-02-2cf0cf8de540ded84b5d7adca914409e.png" width="1271" height="287" class="img_ev3q"></p></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="多租户隔离测试">多租户隔离测试<a class="hash-link" href="#多租户隔离测试" title="直接链接到标题">​</a></h3><p>执行以下步骤进行多租户隔离测试。</p><ol><li><p>登录 minio-t2 租户。</p><p><img loading="lazy" alt="login-t2" src="/cn/assets/images/login-minio-t2-01-05164403493b1533fd4e66907fcc4e17.png" width="1271" height="715" class="img_ev3q"></p><p><img loading="lazy" alt="login-t2" src="/cn/assets/images/login-minio-t2-02-cb97b40d183a2c04c20d5a1583ba2448.png" width="1265" height="531" class="img_ev3q"></p></li><li><p>此时只能看到 minio-t2 内容，minio-t1 的内容被屏蔽。</p><p><img loading="lazy" alt="only-t2" src="/cn/assets/images/only-t2-cdc2c92d78952f8ef3dac0f0a08c5f4f.png" width="1271" height="748" class="img_ev3q"></p></li><li><p>创建 bucket。</p><p><img loading="lazy" alt="create-bucket" src="/cn/assets/images/create-bucket01-5ff6c1c329b6894a95327fd058418214.png" width="1271" height="641" class="img_ev3q"></p><p><img loading="lazy" alt="create-bucket" src="/cn/assets/images/createbucket02-c74362e3b73378315452553cca4a910d.png" width="1271" height="357" class="img_ev3q"></p></li><li><p>创建 path。</p><p><img loading="lazy" alt="create-path" src="/cn/assets/images/create-path01-6301c1074307216c3715f745ad37862b.png" width="1271" height="589" class="img_ev3q"></p><p><img loading="lazy" alt="create-path" src="/cn/assets/images/create-path02-b3875fbfee991a8c69f8627fbf8988b4.png" width="1265" height="281" class="img_ev3q"></p></li><li><p>上传文件。</p><p><img loading="lazy" alt="upload-file" src="/cn/assets/images/upload-file01-a81dcfaf0cb69e2f3d2b4452fcc8d587.png" width="1271" height="253" class="img_ev3q"></p><p><img loading="lazy" alt="upload-file" src="/cn/assets/images/upload-file02-688141fc03bc83b4884b1e309dc8fec3.png" width="1271" height="440" class="img_ev3q"></p></li><li><p>创建用户。</p><p><img loading="lazy" alt="create-user" src="/cn/assets/images/create-user01-fdaa9d62a2b77f01b9c25e90947d01b7.png" width="1173" height="565" class="img_ev3q"></p><p><img loading="lazy" alt="create-user" src="/cn/assets/images/create-user02-02688ec4dcdbfd13c23bde27cbe97adb.png" width="956" height="562" class="img_ev3q"></p><p><img loading="lazy" alt="create-user" src="/cn/assets/images/create-user03-c8e0e15d94570c56b210a807bea71dbc.png" width="1063" height="330" class="img_ev3q"></p><p><img loading="lazy" alt="create-user" src="/cn/assets/images/create-user04-a25e1de99cff7c39c5c6074bf99b171e.png" width="1087" height="418" class="img_ev3q"></p><p><img loading="lazy" alt="create-user" src="/cn/assets/images/create-user05-3094cf2cce3288d4b268b168376d9787.png" width="1265" height="436" class="img_ev3q"></p></li><li><p>配置用户 policy。</p><p><img loading="lazy" alt="user-policy" src="/cn/assets/images/user-policy01-d7ff1a7f6daa3180766f2e3f5aadb33a.png" width="1271" height="559" class="img_ev3q"></p><p><img loading="lazy" alt="user-policy" src="/cn/assets/images/user-policy02-52963322402c0fc498c958fc115bf05d.png" width="1271" height="482" class="img_ev3q"></p></li><li><p>删除 bucket。</p><p><img loading="lazy" alt="delete-bucket" src="/cn/assets/images/delete-bk01-ac535d4a12f5d328317e526567bb08a2.png" width="1265" height="620" class="img_ev3q"></p><p><img loading="lazy" alt="delete-bucket" src="/cn/assets/images/delete-bk02-59b03c470e6adf4d1cd9780c949a3e60.png" width="1265" height="666" class="img_ev3q"></p><p><img loading="lazy" alt="delete-bucket" src="/cn/assets/images/delete-bk03-7b7bcdc79caf87744c8b91bcd9e6888f.png" width="1265" height="519" class="img_ev3q"></p><p><img loading="lazy" alt="delete-bucket" src="/cn/assets/images/delete-bk04-3bf4c2f3cf510b65ecf9da53c8f5a5c6.png" width="1265" height="495" class="img_ev3q"></p><p><img loading="lazy" alt="delete-bucket" src="/cn/assets/images/delete-bk05-68ca55612e200403f48078d611d8897f.png" width="1271" height="605" class="img_ev3q"></p><p><img loading="lazy" alt="delete-bucket" src="/cn/assets/images/delete-bk06-eb4f8695cdc29d00bc1c4d59566a0525.png" width="1277" height="369" class="img_ev3q"></p></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="结论">结论<a class="hash-link" href="#结论" title="直接链接到标题">​</a></h2><p>本次测试是在 Kubernetes 1.22 平台上部署了 MinIO 分布式对象存储并对接 HwameiStor 本地存储。在此环境中完成了基本能力测试、系统安全测试及运维管理测试。</p><p>全部测试成功通过，证实了 HwameiStor 能够完美适配 MinIO 存储方案。</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>标签:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/cn/blog/tags/test">Test</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/cn/blog/test">HwameiStor 能力、安全及运维测试</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-06-06T00:00:00.000Z" itemprop="datePublished">June 6, 2022</time> · <!-- -->20 分钟阅读</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/zhaosimon" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/36882380?v=4" alt="赵燕宁"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/zhaosimon" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">赵燕宁</span></a></div><small class="avatar__subtitle" itemprop="description">开发者</small></div></div></div><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/windsonsea" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/windsonsea.png" alt="要海峰"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/windsonsea" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">要海峰</span></a></div><small class="avatar__subtitle" itemprop="description">编辑</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>本次测试环境为 Kubernetes 1.22，对接 HwameiStor 本地存储后，成功部署 TiDB 1.3，随后执行数据库 SQL 基本能力测试、系统安全测试及运维管理测试。</p><p>全部测试成功通过，证实 HwameiStor 能够完美支撑 TiDB 这类高可用、强一致要求较高、数据规模较大的分布式数据库应用场景。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="tidb-简介">TiDB 简介<a class="hash-link" href="#tidb-简介" title="直接链接到标题">​</a></h2><p>TiDB 是一款同时支持在线事务处理 (OLTP) 与在线分析处理 (OATP) 的融合型分布式数据库产品，具备水平扩缩容、金融级高可用、实时 HTAP（即同时支持 OLTP 和 OATP）、云原生的分布式数据库，兼容 MySQL 5.7 协议和 MySQL 生态等重要特性。TiDB 的目标是为用户提供一站式的 OLTP、OLAP、HTAP 解决方案，适合高可用、强一致要求较高、数据规模较大等各种应用场景。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tidb-整体架构">TiDB 整体架构<a class="hash-link" href="#tidb-整体架构" title="直接链接到标题">​</a></h3><p>TiDB 分布式数据库将整体架构拆分成了多个模块，各模块之间互相通信，组成完整的 TiDB 系统。对应的架构图如下：</p><p><img loading="lazy" alt="TiDB 架构图" src="/cn/assets/images/architecture-84a02fa042e9dcf9890b7d8cd9e0abf0.png" width="2163" height="1269" class="img_ev3q"></p><ul><li><p><strong>TiDB Server</strong></p><p>SQL 层对外暴露 MySQL 协议的连接端点，负责接受客户端的连接，执行 SQL 解析和优化，最终生成分布式执行计划。TiDB 层本身是无状态的，实践中可以启动多个 TiDB 实例，通过负载均衡组件（如 LVS、HAProxy 或 F5）对外提供统一的接入地址，客户端的连接可以均匀地分摊在多个 TiDB 实例上以达到负载均衡的效果。TiDB Server 本身并不存储数据，只是解析 SQL，将实际的数据读取请求转发给底层的存储节点 TiKV（或 TiFlash）。</p></li><li><p><strong>PD (Placement Driver) Server</strong></p><p>整个 TiDB 集群的元信息管理模块，负责存储每个 TiKV 节点实时的数据分布情况和集群的整体拓扑结构，提供 TiDB Dashboard 管控界面，并为分布式事务分配事务 ID。PD 不仅存储元信息，同时还会根据 TiKV 节点实时上报的数据分布状态，下发数据调度命令给具体的 TiKV 节点，可以说是整个集群的“大脑”。此外，PD 本身也是由至少 3 个节点构成，拥有高可用的能力。建议部署奇数个 PD 节点。</p></li><li><p><strong>存储节点</strong></p><ul><li><p>TiKV Server：负责存储数据，从外部看 TiKV 是一个分布式的提供事务的 Key-Value 存储引擎。存储数据的基本单位是 Region，每个 Region 负责存储一个 Key Range（从 StartKey 到 EndKey 的左闭右开区间）的数据，每个 TiKV 节点会负责多个 Region。TiKV 的 API 在 KV 键值对层面提供对分布式事务的原生支持，默认提供了 SI (Snapshot Isolation) 的隔离级别，这也是 TiDB 在 SQL 层面支持分布式事务的核心。TiDB 的 SQL 层做完 SQL 解析后，会将 SQL 的执行计划转换为对 TiKV API 的实际调用。所以，数据都存储在 TiKV 中。另外，TiKV 中的数据都会自动维护多副本（默认为三副本），天然支持高可用和自动故障转移。</p></li><li><p>TiFlash：TiFlash 是一类特殊的存储节点。和普通 TiKV 节点不一样的是，在 TiFlash 内部，数据是以列式的形式进行存储，主要的功能是为分析型的场景加速。</p></li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tidb-数据库的存储">TiDB 数据库的存储<a class="hash-link" href="#tidb-数据库的存储" title="直接链接到标题">​</a></h3><p><img loading="lazy" alt="TiDB数据库的存储" src="/cn/assets/images/storage-4a218645dd6de979bc2db8471dc54ead.png" width="1923" height="1761" class="img_ev3q"></p><ul><li><p><strong>键值对 (Key-Value Pair)</strong></p><p>TiKV 的选择是 Key-Value 模型，并且提供有序遍历方法。TiKV 数据存储的两个关键点：</p><ul><li><p>这是一个巨大的 Map（可以类比一下 C++ 的 std::map），也就是存储的是 Key-Value Pairs。</p></li><li><p>这个 Map 中的 Key-Value pair 按照 Key 的二进制顺序有序，也就是可以 Seek 到某一个 Key 的位置，然后不断地调用 Next 方法以递增的顺序获取比这个 Key 大的 Key-Value。</p></li></ul></li><li><p><strong>本地存储（Rocks DB）</strong></p><p>任何持久化的存储引擎，数据终归要保存在磁盘上，TiKV 也不例外。但是 TiKV 没有选择直接向磁盘上写数据，而是把数据保存在 RocksDB 中，具体的数据落地由 RocksDB 负责。这样做的原因是开发一个单机存储引擎工作量很大，特别是要做一个高性能的单机引擎，需要做各种细致的优化，而 RocksDB 是由 Facebook 开源的一个非常优秀的单机 KV 存储引擎，可以满足 TiKV 对单机引擎的各种要求。这里可以简单地认为 RocksDB 是一个单机的持久化 Key-Value Map。</p></li><li><p><strong>Raft 协议</strong></p><p>TiKV 选择了 Raft 算法来保证单机失效的情况下数据不丢失不出错。简单来说，就是把数据复制到多台机器上，这样某一台机器无法提供服务时，其他机器上的副本还能提供服务。这个数据复制方案可靠并且高效，能处理副本失效的情况。</p></li><li><p><strong>Region</strong></p><p>TiKV 选择了按照 Key 划分 Range。某一段连续的 Key 都保存在一个存储节点上。将整个 Key-Value 空间分成很多段，每一段是一系列连续的 Key，称为一个 Region。尽量让每个 Region 中保存的数据不超过一定的大小，目前在 TiKV 中默认是不超过 96MB。每一个 Region 都可以用 <!-- -->[StartKey，EndKey]<!-- --> 这样的左闭右开区间来描述。</p></li><li><p><strong>MVCC</strong></p><p>TiKV实现了多版本并发控制 (MVCC)。</p></li><li><p><strong>分布式 ACID 事务</strong></p><p>TiKV 的事务采用的是 Google 在 BigTable 中使用的事务模型：Percolator。</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="搭建测试环境">搭建测试环境<a class="hash-link" href="#搭建测试环境" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kubernetes-集群">Kubernetes 集群<a class="hash-link" href="#kubernetes-集群" title="直接链接到标题">​</a></h3><p>本次测试使用三台虚拟机节点部署 Kubernetes 集群，包括 1 个 master 节点和 2 个 worker节点。Kubelete 版本为 1.22.0。</p><p><img loading="lazy" alt="k8s cluster" src="/cn/assets/images/k8scluster-d66dbdd30a356cd2d92b2b4aa4be67cf.png" width="1032" height="202" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="hwameistor-本地存储">HwameiStor 本地存储<a class="hash-link" href="#hwameistor-本地存储" title="直接链接到标题">​</a></h3><ol><li><p>在 Kubernetes 集群上部署 HwameiStor 本地存储</p><p><img loading="lazy" alt="HwameiStor 本地存储" src="/cn/assets/images/hwameistor-b1534b2445747773ba035b59d9a2e4d9.png" width="900" height="383" class="img_ev3q"></p></li><li><p>在两台 worker 节点上分别为 HwameiStor 配置一块 100G 的本地磁盘 sdb</p><p><img loading="lazy" alt="sdb1" src="/cn/assets/images/sdb1-d44c872aaeec1d38a96fe2b64d614ec7.png" width="1106" height="504" class="img_ev3q"></p><p><img loading="lazy" alt="sdb2" src="/cn/assets/images/sdb2-04c3bbb6819254df2091337943b8a903.png" width="1262" height="846" class="img_ev3q"></p></li><li><p>创建 storagClass</p><p><img loading="lazy" alt="创建 StorageClass" src="/cn/assets/images/storageclass-2f60d3b59099601a065cad53084b7410.png" width="1846" height="116" class="img_ev3q"></p></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="在-kubernetes-上部署-tidb">在 Kubernetes 上部署 TiDB<a class="hash-link" href="#在-kubernetes-上部署-tidb" title="直接链接到标题">​</a></h3><p>可以使用 TiDB Operator 在 Kubernetes 上部署 TiDB。TiDB Operator 是 Kubernetes 上的 TiDB 集群自动运维系统，提供包括部署、升级、扩缩容、备份恢复、配置变更的 TiDB 全生命周期管理。借助 TiDB Operator，TiDB 可以无缝运行在公有云或私有部署的 Kubernetes 集群上。</p><p>TiDB 与 TiDB Operator 版本的对应关系如下：</p><table><thead><tr><th>TiDB  版本</th><th>适用的 TiDB Operator 版本</th></tr></thead><tbody><tr><td>dev</td><td>dev</td></tr><tr><td>TiDB  &gt;= 5.4</td><td>1.3</td></tr><tr><td>5.1  &lt;= TiDB &lt; 5.4</td><td>1.3（推荐），1.2</td></tr><tr><td>3.0  &lt;= TiDB &lt; 5.1</td><td>1.3（推荐），1.2，1.1</td></tr><tr><td>2.1  &lt;= TiDB &lt; 3.0</td><td>1.0（停止维护）</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="部署-tidb-operator">部署 TiDB Operator<a class="hash-link" href="#部署-tidb-operator" title="直接链接到标题">​</a></h4><ol><li><p>安装 TiDB CRDs</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f https://raw.githubusercontent.com/pingcap/tidb-operator/master/manifests/crd.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制到剪切板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>安装 TiDB Operator</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm repo </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> pingcap https://charts.pingcap.org/ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create namespace tidb-admin </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> --namespace tidb-admin tidb-operator pingcap/tidb-operator --version v1.3.2 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--set </span><span class="token assign-left variable" style="color:#36acaa">operatorImage</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">registry.cn-beijing.aliyuncs.com/tidb/tidb-operator:v1.3.2 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--set </span><span class="token assign-left variable" style="color:#36acaa">tidbBackupManagerImage</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">registry.cn-beijing.aliyuncs.com/tidb/tidb-backup-manager:v1.3.2 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--set scheduler.kubeSchedulerImageName</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">registry.cn-hangzhou.aliyuncs.com/google_containers/kube-scheduler</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制到剪切板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>检查 TiDB Operator 组件</p><p><img loading="lazy" alt="检查 TiDB Operator 组件" src="/cn/assets/images/check-ed419916033fab0905560bd4a2f61af3.png" width="2008" height="180" class="img_ev3q"></p></li></ol><h4 class="anchor anchorWithStickyNavbar_LWe7" id="部署-tidb-集群">部署 TiDB 集群<a class="hash-link" href="#部署-tidb-集群" title="直接链接到标题">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create namespace tidb-cluster </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl -n tidb-cluster apply -f https://raw.githubusercontent.com/pingcap/tidb-operator/master/examples/basic/tidb-cluster.yaml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl -n tidb-cluster apply -f https://raw.githubusercontent.com /pingcap/tidb-operator/master/examples/basic/tidb-monitor.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制到剪切板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="部署 TiDB 集群" src="/cn/assets/images/deploytidb-2d47220e268930b68788f6b5719ff1b6.png" width="2054" height="352" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="连接-tidb-集群">连接 TiDB 集群<a class="hash-link" href="#连接-tidb-集群" title="直接链接到标题">​</a></h4><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">yum -y </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> mysql-client</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制到剪切板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="connecttidb" src="/cn/assets/images/connecttidb-a7581718045137e665d6661f70cfa7ec.png" width="2430" height="719" class="img_ev3q"></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl port-forward -n tidb-cluster svc/basic-tidb </span><span class="token number" style="color:#36acaa">4000</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> pf4000.out </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制到剪切板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="连接 TiDB 集群" src="/cn/assets/images/connect1-a3321cfd632f9c6972be8c5b479cc74b.png" width="2592" height="124" class="img_ev3q"></p><p><img loading="lazy" alt="连接 TiDB 集群" src="/cn/assets/images/connect2-b8e095de64a1ddeed0081558d1e7df2a.png" width="696" height="162" class="img_ev3q"></p><p><img loading="lazy" alt="连接 TiDB 集群" src="/cn/assets/images/connect3-abfb57d8b142dfffe9a51c08bd1b2b49.png" width="2499" height="749" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="检查并验证-tidb-集群状态">检查并验证 TiDB 集群状态<a class="hash-link" href="#检查并验证-tidb-集群状态" title="直接链接到标题">​</a></h4><ol><li><p>创建 Hello_world 表</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">create</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> hello_world </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">unsigned</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">not</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">null</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">auto_increment</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">primary</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> v </span><span class="token keyword" style="color:#00009f">varchar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制到剪切板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="创建 Hello_world 表" src="/cn/assets/images/helloworld-ecab0f377f6eff58e4c83330317e02f2.png" width="1660" height="1110" class="img_ev3q"></p></li><li><p>查询 TiDB 版本号</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">select tidb_version()\G;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制到剪切板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="连接 TiDB 集群" src="/cn/assets/images/checkversion-3d5ce2da304da3ad168d5e006fb04573.png" width="952" height="418" class="img_ev3q"></p></li><li><p>查询 Tikv 存储状态</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> information_schema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tikv_store_status\G</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制到剪切板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="查询 Tikv 存储状态" src="/cn/assets/images/checkstorage-bdfd2faf28d7fd43cb0ba343b237ccdc.png" width="1014" height="854" class="img_ev3q"></p></li></ol><h4 class="anchor anchorWithStickyNavbar_LWe7" id="hwameistor-存储配置">HwameiStor 存储配置<a class="hash-link" href="#hwameistor-存储配置" title="直接链接到标题">​</a></h4><p>从 <code>storageClass local-storage-hdd-lvm</code> 分别为 tidb-tikv 及 tidb-pd 创建一个 PVC:</p><p><img loading="lazy" alt="HwameiStor 存储配置" src="/cn/assets/images/pvc-72ff9e3fbbb8ab8087d52ab36dd732f7.png" width="2498" height="248" class="img_ev3q"></p><p><img loading="lazy" alt="HwameiStor 存储配置" src="/cn/assets/images/pvc1-17195a3d3fbaf5e8832f6013cb00af45.png" width="556" height="773" class="img_ev3q"></p><p><img loading="lazy" alt="HwameiStor 存储配置" src="/cn/assets/images/pvc2-c01fe3c4a62af87680a8659b42a5237f.png" width="555" height="743" class="img_ev3q"></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get po basic-tikv-0 -oyaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制到剪切板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="HwameiStor 存储配置" src="/cn/assets/images/mountpvc-ba5f069afefb45a429a80a93300a760e.png" width="525" height="856" class="img_ev3q"></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get po basic-pd-0 -oyaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制到剪切板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><img loading="lazy" alt="HwameiStor 存储配置" src="/cn/assets/images/mountpvc1-6efe78023666c7944839572e9a9deabc.png" width="569" height="871" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="测试内容">测试内容<a class="hash-link" href="#测试内容" title="直接链接到标题">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="数据库-sql-基本能力测试">数据库 SQL 基本能力测试<a class="hash-link" href="#数据库-sql-基本能力测试" title="直接链接到标题">​</a></h3><p>完成部署数据库集群后，执行了以下基本能力测试，全部通过。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="分布式事务">分布式事务<a class="hash-link" href="#分布式事务" title="直接链接到标题">​</a></h4><p>测试目的：支持在多种隔离级别下，实现分布式数据操作的完整性约束即 ACID属性</p><p>测试步骤：</p><ol><li><p>创建测试数据库 CREATE DATABASE testdb</p></li><li><p>创建测试用表 CREATE TABLE <code>t_test ( id int AUTO_INCREMENT, name varchar(32), PRIMARY KEY (id) )</code></p></li><li><p>运行测试脚本</p></li></ol><p>测试结果：支持在多种隔离级别下，实现分布式数据操作的完整性约束即 ACID 属性</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="对象隔离">对象隔离<a class="hash-link" href="#对象隔离" title="直接链接到标题">​</a></h4><p>测试目的：测试不同 schema 实现对象隔离</p><p>测试脚本：</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">create</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">database</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">not</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">exists</span><span class="token plain"> testdb</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">use</span><span class="token plain"> testdb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">create</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">not</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">exists</span><span class="token plain"> t_test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> id                   </span><span class="token keyword" style="color:#00009f">bigint</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name                 </span><span class="token keyword" style="color:#00009f">varchar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sale_time            </span><span class="token keyword" style="color:#00009f">datetime</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">default</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">current_timestamp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">constraint</span><span class="token plain"> pk_t_test </span><span class="token keyword" style="color:#00009f">primary</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">key</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">insert</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">into</span><span class="token plain"> t_test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">values</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;a&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;b&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;c&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">create</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">user</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;readonly&#x27;</span><span class="token variable" style="color:#36acaa">@&#x27;%&#x27;</span><span class="token plain"> identified </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;readonly&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">grant</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> testdb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">to</span><span class="token plain"> readonly</span><span class="token variable" style="color:#36acaa">@&#x27;%&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> testdb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t_test</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">update</span><span class="token plain"> testdb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">t_test </span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;aaa&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">create</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">user</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;otheruser&#x27;</span><span class="token variable" style="color:#36acaa">@&#x27;%&#x27;</span><span class="token plain"> identified </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;otheruser&quot;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制到剪切板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>测试结果：支持创建不同 schema 实现对象隔离</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="表操作支持">表操作支持<a class="hash-link" href="#表操作支持" title="直接链接到标题">​</a></h4><p>测试目的：测试是否支持创建、删除和修改表数据、DML、列、分区表</p><p>测试步骤：连接数据库后按步骤执行测试脚本</p><p>测试脚本：</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 创建和删除表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">drop</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">exists</span><span class="token plain"> t_test</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">create</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">not</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">exists</span><span class="token plain"> t_test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> id                   </span><span class="token keyword" style="color:#00009f">bigint</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">default</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;0&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name                 </span><span class="token keyword" style="color:#00009f">varchar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">default</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sale_time            </span><span class="token keyword" style="color:#00009f">datetime</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">default</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">current_timestamp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">constraint</span><span class="token plain"> pk_t_test </span><span class="token keyword" style="color:#00009f">primary</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">key</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 删除和修改</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">insert</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">into</span><span class="token plain"> t_test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">values</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;a&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;b&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;c&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;d&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;e&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">update</span><span class="token plain"> t_test </span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;aaa&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">update</span><span class="token plain"> t_test </span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;bbb&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">delete</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> t_dml </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> id</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 修改、增加、删除列</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">alter</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> t_test </span><span class="token keyword" style="color:#00009f">modify</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">column</span><span class="token plain"> name </span><span class="token keyword" style="color:#00009f">varchar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">250</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">alter</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> t_test </span><span class="token keyword" style="color:#00009f">add</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">column</span><span class="token plain"> col </span><span class="token keyword" style="color:#00009f">varchar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">insert</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">into</span><span class="token plain"> t_test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">col</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">values</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;test&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;new_col&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">alter</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> t_test </span><span class="token keyword" style="color:#00009f">add</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">column</span><span class="token plain"> colwithdefault </span><span class="token keyword" style="color:#00009f">varchar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">default</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;aaaa&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">insert</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">into</span><span class="token plain"> t_test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">values</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;testdefault&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">insert</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">into</span><span class="token plain"> t_test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">colwithdefault </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">values</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;test&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;non-default &#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">alter</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> t_test </span><span class="token keyword" style="color:#00009f">drop</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">column</span><span class="token plain"> colwithdefault</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 分区表类型（仅摘录部分脚本）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> employees </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    id </span><span class="token keyword" style="color:#00009f">INT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fname </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">30</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lname </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">30</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hired </span><span class="token keyword" style="color:#00009f">DATE</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;1970-01-01&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    separated </span><span class="token keyword" style="color:#00009f">DATE</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;9999-12-31&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">job_code </span><span class="token keyword" style="color:#00009f">INT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">store_id </span><span class="token keyword" style="color:#00009f">INT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制到剪切板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>测试结果：支持创建、删除和修改表数据、DML、列、分区表</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="索引支持">索引支持<a class="hash-link" href="#索引支持" title="直接链接到标题">​</a></h4><p>测试目的：验证多种类型的索引（唯一、聚簇、分区、Bidirectional indexes、Expression-based indexes、哈希索引等等）以及索引重建操作。</p><p>测试脚本：</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">alter</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> t_test </span><span class="token keyword" style="color:#00009f">add</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">unique</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">index</span><span class="token plain"> udx_t_test </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 默认就是主键聚簇索引</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ADMIN </span><span class="token keyword" style="color:#00009f">CHECK</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> t_test</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">create</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">index</span><span class="token plain"> time_idx </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> t_test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sale_time</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">alter</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> t_test </span><span class="token keyword" style="color:#00009f">drop</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">index</span><span class="token plain"> time_idx</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">admin </span><span class="token keyword" style="color:#00009f">show</span><span class="token plain"> ddl jobs</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">admin </span><span class="token keyword" style="color:#00009f">show</span><span class="token plain"> ddl job queries </span><span class="token number" style="color:#36acaa">156</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">create</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">index</span><span class="token plain"> time_idx </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> t_test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sale_time</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制到剪切板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>测试结果：支持创建、删除、组合、单列、唯一索引</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="表达式">表达式<a class="hash-link" href="#表达式" title="直接链接到标题">​</a></h4><p>测试目的：验证分布式数据库的表达式支持 if、casewhen、forloop、whileloop、loop exit when 等语句（上限 5 类）</p><p>前提条件：数据库集群已经部署完成。</p><p>测试脚本：</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">CASE</span><span class="token plain"> id </span><span class="token keyword" style="color:#00009f">WHEN</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">THEN</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;first&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">WHEN</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">THEN</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;second&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">ELSE</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;OTHERS&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">END</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> id_new  </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> t_test</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">IF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;int2+&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;int2-&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> t_test</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制到剪切板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>测试结果：支持 if、case when、for loop、while loop、loop exit when 等语句（上限 5 类）</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="执行计划解析">执行计划解析<a class="hash-link" href="#执行计划解析" title="直接链接到标题">​</a></h4><p>测试目的：验证分布式数据库的执行计划解析支持</p><p>前提条件：数据库集群已经部署完成。</p><p>测试脚本：</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">explain</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">analyze</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> t_test </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> id </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">IN</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">explain</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">analyze</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> t_test a </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">EXISTS</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> t_test b </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">explain</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">analyze</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">IF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;int2+&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;int2-&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> t_test</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制到剪切板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>测试结果：支持执行计划的解析</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="执行计划绑定">执行计划绑定<a class="hash-link" href="#执行计划绑定" title="直接链接到标题">​</a></h4><p>测试目的：验证分布式数据库的执行计划绑定功能</p><p>测试步骤：</p><ol><li><p>查看 sql 语句的当前执行计划</p></li><li><p>使用绑定特性</p></li><li><p>查看该 sql 语句绑定后的执行计划</p></li><li><p>删除绑定</p></li></ol><p>测试脚本：</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">explain</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> employees3 a </span><span class="token keyword" style="color:#00009f">join</span><span class="token plain"> employees4 b </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">lname</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;Johnson&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">explain</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*+ hash_join(a,b) */</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> employees3 a </span><span class="token keyword" style="color:#00009f">join</span><span class="token plain"> employees4 b </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">id </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">lname</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;Johnson&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制到剪切板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>测试结果：没有使用 hint 时可能不是 hash_join，使用 hint 后一定是 hash_join。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="常用函数">常用函数<a class="hash-link" href="#常用函数" title="直接链接到标题">​</a></h4><p>测试目的：验证分布式数据库的标准的数据库函数(支持的函数类型）</p><p>测试结果：支持标准的数据库函数</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="显式隐式事务">显式/隐式事务<a class="hash-link" href="#显式隐式事务" title="直接链接到标题">​</a></h4><p>测试目的：验证分布式数据库的事务支持</p><p>测试结果：支持显示与隐式事务</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="字符集">字符集<a class="hash-link" href="#字符集" title="直接链接到标题">​</a></h4><p>测试目的：验证分布式数据库的数据类型支持</p><p>测试结果：目前只支持 UTF-8 mb4 字符集</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="锁支持">锁支持<a class="hash-link" href="#锁支持" title="直接链接到标题">​</a></h4><p>测试目的：验证分布式数据库的锁实现</p><p>测试结果：描述了锁的实现方式，R-R/R-W/W-W 情况下阻塞情况，死锁处理方式</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="隔离级别">隔离级别<a class="hash-link" href="#隔离级别" title="直接链接到标题">​</a></h4><p>测试目的：验证分布式数据库的事务隔离级别</p><p>测试结果：支持 si 隔离级别，支持 rc 隔离级别（4.0 GA 版本）</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="分布式复杂查询">分布式复杂查询<a class="hash-link" href="#分布式复杂查询" title="直接链接到标题">​</a></h4><p>测试目的：验证分布式数据库的分布式复杂查询能力</p><p>测试结果：支持跨节点 join 等分布式复杂查询、操作等，支持窗口函数、层次查询</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="系统安全测试">系统安全测试<a class="hash-link" href="#系统安全测试" title="直接链接到标题">​</a></h3><p>这部分测试系统安全，完成数据库集群部署后，以下安全测试全部通过。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="账号管理与权限测试">账号管理与权限测试<a class="hash-link" href="#账号管理与权限测试" title="直接链接到标题">​</a></h4><p>测试目的：验证分布式数据库的账号权限管理</p><p>测试脚本：</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> host</span><span class="token punctuation" style="color:#393A34">,</span><span class="token keyword" style="color:#00009f">user</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">authentication_string </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> mysql</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">user</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">create</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">user</span><span class="token plain"> tidb IDENTIFIED </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;tidb&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> host</span><span class="token punctuation" style="color:#393A34">,</span><span class="token keyword" style="color:#00009f">user</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">authentication_string </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> mysql</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">user</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> password </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> tidb </span><span class="token operator" style="color:#393A34">=</span><span class="token plain">password</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;tidbnew&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> host</span><span class="token punctuation" style="color:#393A34">,</span><span class="token keyword" style="color:#00009f">user</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">authentication_string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">Select_priv </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> mysql</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">user</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">grant</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">.</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">to</span><span class="token plain"> tidb</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">flush </span><span class="token keyword" style="color:#00009f">privileges</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> host</span><span class="token punctuation" style="color:#393A34">,</span><span class="token keyword" style="color:#00009f">user</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">authentication_string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">Select_priv </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> mysql</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">user</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">grant</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">all</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">privileges</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">.</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">to</span><span class="token plain"> tidb</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">flush </span><span class="token keyword" style="color:#00009f">privileges</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain">  mysql</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">user</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">user</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;tidb&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">revoke</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">.</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> tidb</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">flush </span><span class="token keyword" style="color:#00009f">privileges</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">revoke</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">all</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">privileges</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">.</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> tidb</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">flush </span><span class="token keyword" style="color:#00009f">privileges</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">grant</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> test</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">TEST_HOTSPOT </span><span class="token keyword" style="color:#00009f">to</span><span class="token plain"> tidb</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">drop</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">user</span><span class="token plain"> tidb</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制到剪切板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>测试结果：</p><ul><li><p>支持创建、修改删除账号，并配置和密码，支持安全、审计和数据管理三权分立</p></li><li><p>根据不同账号，对数库各个级别权限控制包括：实例/库/表/列级别</p></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="访问控制">访问控制<a class="hash-link" href="#访问控制" title="直接链接到标题">​</a></h4><p>测试目的：验证分布式数据库的权限访问控制，数据库数据通过赋予基本增删改查访问权限控制</p><p>测试脚本：</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">u root </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">h </span><span class="token number" style="color:#36acaa">172.17</span><span class="token number" style="color:#36acaa">.49</span><span class="token number" style="color:#36acaa">.222</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">P </span><span class="token number" style="color:#36acaa">4000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">drop</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">user</span><span class="token plain"> tidb</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">drop</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">user</span><span class="token plain"> tidb1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">create</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">user</span><span class="token plain"> tidb IDENTIFIED </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;tidb&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">grant</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> tidb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">to</span><span class="token plain"> tidb</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">grant</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">insert</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> tidb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">to</span><span class="token plain"> tidb</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">grant</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">update</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> tidb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">to</span><span class="token plain"> tidb</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">grant</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">delete</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> tidb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">to</span><span class="token plain"> tidb</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">flush </span><span class="token keyword" style="color:#00009f">privileges</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">show</span><span class="token plain"> grants </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> tidb</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">exit</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">u tidb </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">h </span><span class="token number" style="color:#36acaa">172.17</span><span class="token number" style="color:#36acaa">.49</span><span class="token number" style="color:#36acaa">.222</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">ptidb </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">P </span><span class="token number" style="color:#36acaa">4000</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">D tidb </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">e </span><span class="token string" style="color:#e3116c">&#x27;select * from aa;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">u tidb </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">h </span><span class="token number" style="color:#36acaa">172.17</span><span class="token number" style="color:#36acaa">.49</span><span class="token number" style="color:#36acaa">.222</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">ptidb </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">P </span><span class="token number" style="color:#36acaa">4000</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">D tidb </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">e </span><span class="token string" style="color:#e3116c">&#x27;insert into aa values(2);&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">u tidb </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">h </span><span class="token number" style="color:#36acaa">172.17</span><span class="token number" style="color:#36acaa">.49</span><span class="token number" style="color:#36acaa">.222</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">ptidb </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">P </span><span class="token number" style="color:#36acaa">4000</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">D tidb </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">e </span><span class="token string" style="color:#e3116c">&#x27;update aa set id=3;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">u tidb </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">h </span><span class="token number" style="color:#36acaa">172.17</span><span class="token number" style="color:#36acaa">.49</span><span class="token number" style="color:#36acaa">.222</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">ptidb </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">P </span><span class="token number" style="color:#36acaa">4000</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">D tidb </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">e </span><span class="token string" style="color:#e3116c">&#x27;delete from aa where id=3;&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制到剪切板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>测试结果：数据库数据通过赋予基本增删改查访问权限控制。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="白名单">白名单<a class="hash-link" href="#白名单" title="直接链接到标题">​</a></h4><p>测试目的：验证分布式数据库的白名单功能</p><p>测试脚本：</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">u root </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">h </span><span class="token number" style="color:#36acaa">172.17</span><span class="token number" style="color:#36acaa">.49</span><span class="token number" style="color:#36acaa">.102</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">P </span><span class="token number" style="color:#36acaa">4000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">drop</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">user</span><span class="token plain"> tidb</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">create</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">user</span><span class="token plain"> tidb</span><span class="token variable" style="color:#36acaa">@&#x27;127.0.0.1&#x27;</span><span class="token plain"> IDENTIFIED </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;tidb&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">flush </span><span class="token keyword" style="color:#00009f">privileges</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> mysql</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">user</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">user</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;tidb&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">u tidb </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">h </span><span class="token number" style="color:#36acaa">127.0</span><span class="token number" style="color:#36acaa">.0</span><span class="token number" style="color:#36acaa">.1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">P </span><span class="token number" style="color:#36acaa">4000</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">ptidb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">u tidb </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">h </span><span class="token number" style="color:#36acaa">172.17</span><span class="token number" style="color:#36acaa">.49</span><span class="token number" style="color:#36acaa">.102</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">P </span><span class="token number" style="color:#36acaa">4000</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">ptidb</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制到剪切板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>测试结果：支持 IP 白名单功能，支持 IP 段通配操作</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="操作日志记录">操作日志记录<a class="hash-link" href="#操作日志记录" title="直接链接到标题">​</a></h4><p>测试目的：验证分布式数据库的操作监控能力</p><p>测试脚本：<code>kubectl -ntidb-cluster logs tidb-test-pd-2 --tail 22</code></p><p>测试结果：记录用户通过运维管理控制台或者 API 执行的关键操作或者错误操作</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="运维管理测试">运维管理测试<a class="hash-link" href="#运维管理测试" title="直接链接到标题">​</a></h3><p>这部分测试系统运维，完成数据库集群部署后，以下运维管理测试全部通过。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="数据导入导出">数据导入导出<a class="hash-link" href="#数据导入导出" title="直接链接到标题">​</a></h4><p>测试目的：验证分布式数据库的数据导入导出的工具支持</p><p>测试脚本：</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sbtest1 </span><span class="token keyword" style="color:#00009f">into</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">outfile</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/sbtest1.csv&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">load</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">data</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">local</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">infile</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/sbtest1.csv&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">into</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> test100</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制到剪切板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>测试结果：支持按表、schema、database 级别的逻辑导出导入</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="慢日志查询">慢日志查询<a class="hash-link" href="#慢日志查询" title="直接链接到标题">​</a></h4><p>测试目的：获取慢查询的 SQL 信息</p><p>前提条件：SQL 执行时间需大于配置的慢查询记录阈值,且 SQL 执行完毕</p><p>测试步骤：</p><ol><li><p>调整慢查询阈值到 100ms</p></li><li><p>执行 sql</p></li><li><p>查看 log/系统表/dashboard 中的慢查询信息</p></li></ol><p>测试脚本：</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">show</span><span class="token plain"> variables </span><span class="token operator" style="color:#393A34">like</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;tidb_slow_log_threshold&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> tidb_slow_log_threshold</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> query_time</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> query </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> information_schema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">slow_query </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> is_internal </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> query_time </span><span class="token keyword" style="color:#00009f">desc</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">limit</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制到剪切板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>测试结果：可以获取慢查询信息</p><blockquote><p>有关测试详情，请查阅 <a target="_blank" href="/cn/assets/files/TiDBonHwameiStor-906bfd680bcfe09f47e9c9e5ed8bc3ec.docx">TiDB on hwameiStor 部署及测试记录</a>。</p></blockquote></div><footer class="row docusaurus-mt-lg"><div class="col"><b>标签:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/cn/blog/tags/test">Test</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="浏览博客列表"></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">文档</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/cn/docs/intro">文档</a></li></ul></div><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/hwameistor/hwameistor" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/cn/blog">Blog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">版权所有 © 2022 HwameiStor, 上海道客网络科技有限公司.Linux 基金会拥有注册商标并使用商标,有关 Linux 基金会的商标列表,请参阅我们的商标使用页面:https://www.linuxfoundation.org/trademark-usage.</div></div></div></footer></div>
<script src="/cn/assets/js/runtime~main.4ec86df7.js"></script>
<script src="/cn/assets/js/main.20355232.js"></script>
</body>
</html>