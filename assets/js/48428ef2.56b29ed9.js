"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[536],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return h}});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},d=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,d=r(e,["components","mdxType","originalType","parentName"]),p=c(n),h=o,m=p["".concat(l,".").concat(h)]||p[h]||u[h]||i;return n?a.createElement(m,s(s({ref:t},d),{},{components:n})):a.createElement(m,s({ref:t},d))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,s=new Array(i);s[0]=p;var r={};for(var l in t)hasOwnProperty.call(t,l)&&(r[l]=t[l]);r.originalType=e,r.mdxType="string"==typeof e?e:o,s[1]=r;for(var c=2;c<i;c++)s[c]=n[c];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},796:function(e,t,n){n.r(t),n.d(t,{assets:function(){return d},contentTitle:function(){return l},default:function(){return h},frontMatter:function(){return r},metadata:function(){return c},toc:function(){return u}});var a=n(7462),o=n(3366),i=(n(7294),n(3905)),s=["components"],r={sidebar_position:6,sidebar_label:"LVM"},l="LVM",c={unversionedId:"04concepts/05lvm",id:"04concepts/05lvm",title:"LVM",description:"The full name of LVM is Logical Volume Manager. It adds a logical layer between the disk partition and the file system, provides an abstract disk volume for the file system to shield the underlying disk partition layout, and establishes a file system on the disk volume.",source:"@site/docs/04concepts/05lvm.md",sourceDirName:"04concepts",slug:"/04concepts/05lvm",permalink:"/docs/04concepts/05lvm",editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/04concepts/05lvm.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6,sidebar_label:"LVM"},sidebar:"tutorialSidebar",previous:{title:"Volume",permalink:"/docs/04concepts/04volume"},next:{title:"PV and PVC",permalink:"/docs/04concepts/06pvc"}},d={},u=[{value:"Basic functionality",id:"basic-functionality",level:2},{value:"Advantages",id:"advantages",level:2},{value:"Basic procedure to use LVM",id:"basic-procedure-to-use-lvm",level:2},{value:"LV expansion",id:"lv-expansion",level:2},{value:"VG expansion",id:"vg-expansion",level:2},{value:"LV snapshots",id:"lv-snapshots",level:2}],p={toc:u};function h(e){var t=e.components,n=(0,o.Z)(e,s);return(0,i.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"lvm"},"LVM"),(0,i.kt)("p",null,"The full name of LVM is Logical Volume Manager. It adds a logical layer between the disk partition and the file system, provides an abstract disk volume for the file system to shield the underlying disk partition layout, and establishes a file system on the disk volume."),(0,i.kt)("p",null,"With LVM, you can dynamically resize file systems without repartitioning the disk, and file systems managed with LVM can span disks. When a new disk is added to the server, the administrator does not have to move the original files to the new disk, but directly extends the file system across the disk through LVM. That is, by encapsulating the underlying physical hard disk, and then presenting it to the upper-level application in the form of a logical volume."),(0,i.kt)("p",null,"LVM encapsulates the underlying hard disk. When we operate the underlying physical hard disk, we no longer operate on the partition, but perform the underlying disk management operation on it through something called a logical volume."),(0,i.kt)("h2",{id:"basic-functionality"},"Basic functionality"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Physical media (PM):")," LVM storage media can be partitions, disks, RAID arrays, or SAN disks."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Physical volume (PV):")," Physical volume is the basic storage logical block of LVM, but compared with basic physical storage media (such as partitions, disks, etc.), it contains management parameters related to LVM. A physical volume can be partitioned by a disk, or it can be the disk itself. Disks must be initialized as LVM physical volumes to be used with LVM."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Volume groups (VG):")," It can be resized online by absorbing new physical volumes (PVs) or ejecting existing ones."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Logical volumes (LV):")," It can be resized online by concatenating extents onto them or truncating extents from them."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Physical extents (PE):")," The smallest storage unit that can be allocated in the physical volume. The size of PE can be specified, and the default is 4MB."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Logical extents (LE):")," The smallest storage unit that can be allocated in an logical volume. In the same volume group, the size of LE is the same as that of PE, and there is a one-to-one correspondence."),(0,i.kt)("h2",{id:"advantages"},"Advantages"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Use volume groups to make multiple hard drives look like one big hard drive"),(0,i.kt)("li",{parentName:"ul"},"Using logical volumes, partitions can span multiple hard disk spaces sdb1 sdb2 sdc1 sdd2 sdf"),(0,i.kt)("li",{parentName:"ul"},"Using logical volumes, you can dynamically resize it if the storage space is insufficient"),(0,i.kt)("li",{parentName:"ul"},"When resizing a logical volume, you need not to consider the location of the logical volume on a hard disk, and you need not to worry about no contiguous space available"),(0,i.kt)("li",{parentName:"ul"},"LV and VG can be created, deleted, and resized online, and the file system on LVM also needs to be resized"),(0,i.kt)("li",{parentName:"ul"},"You can create snapshots, which can be used to back up file systems"),(0,i.kt)("li",{parentName:"ul"},"RAID + LVM combined: LVM is a software method of volume management, while RAID is a method of disk management. For important data, RAID is used to protect physical disks from failures and services are not interrupted, and LVM is used to achieve a good volume management and better use of disk resources.")),(0,i.kt)("h2",{id:"basic-procedure-to-use-lvm"},"Basic procedure to use LVM"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Format a physical disk as PVs, that is, the space is divided into PEs. A PV contains multiple PEs."),(0,i.kt)("li",{parentName:"ol"},"Add different PVs to the same VG, that is, the PEs of different PVs all enter the PE pool of the VG. A VG contains multiple PVs."),(0,i.kt)("li",{parentName:"ol"},"Create logical volumes in the VG. This creation process is based on PE, so the PEs that make up the LV may come from different physical disks. LV is created based on PE."),(0,i.kt)("li",{parentName:"ol"},"Directly format the LV and mount it for use."),(0,i.kt)("li",{parentName:"ol"},"The scaling in / out of an LV is actually to increase or decrease the number of PEs that make up the LV without losing the original data."),(0,i.kt)("li",{parentName:"ol"},"Format the LV and mount it for use.")),(0,i.kt)("h2",{id:"lv-expansion"},"LV expansion"),(0,i.kt)("p",null,"First, determine if there is available space for expansion, because space is created from VG, and LVs cannot be expanded across VGs. If the VG has no capacity, you need to expand the VG first. Perform the following steps:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"$ vgs\nVG #PV #LV #SN Attr VSize VFree\nvg-sdb1 1 8 1 wz--n- <16.00g <5.39g\n$ lvextend -L +100M  -r /dev/vg-sdb1/lv-sdb1     #\u5c06 /dev/vg-sdb1/lv-sdb \u6269\u5bb9 100M\n")),(0,i.kt)("h2",{id:"vg-expansion"},"VG expansion"),(0,i.kt)("p",null,"If there is not sufficient space in the VG and you need to add a new disk, run the following commands in sequence:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"$  pvcreate /dev/sdc\n$  vgextend vg-sdb1 /dev/sdb3\n")),(0,i.kt)("h2",{id:"lv-snapshots"},"LV snapshots"),(0,i.kt)("p",null,"The LVM mechanism provides the function of snapshotting LVs to obtain a state-consistent backup of the file system. LVM adopts Copy-On-Write (COW) technology, which can be backed up without stopping the service or setting the logical volume as read-only. Using the LVM, snapshot function can enable consistent backup without affecting the availability of the server."),(0,i.kt)("p",null,"The copy-on-write adopted by LVM means that when creating an LVM snapshot, only the metadata in the original volume is copied. In other words, when an LVM logical volume is created, no physical replication of the data occurs. In another words, only the metadata is copied, not the physical data, so the snapshot creation is almost real-time. When a write operation is performed on the original volume, the snapshot will track the changes to the blocks in the original volume. At this time, the data that will be changed on the original volume will be copied to the space reserved by the snapshot before the change."))}h.isMDXComponent=!0}}]);